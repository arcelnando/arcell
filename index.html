<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Album Digital Khirza - Premium Glow V3.2 FINAL (FIX)</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
/* Reset & Global */
html, body {
  margin:0; padding:0;
  font-family:'Poppins',sans-serif;
  height:100%; width:100%;
  overflow:hidden; /* Pastikan tidak ada scrollbar utama */
  background:linear-gradient(135deg,#ffd6e8,#ffb3d1,#ff99c7);
  display:flex; justify-content:center; align-items:center;
  color:#333; /* Warna teks default */
  line-height:1.6;
}

/* Particle Background */
#particleContainer{
  position:fixed; top:0; left:0;
  width:100%; height:100%;
  pointer-events:none;
  overflow:hidden; z-index:0;
}
.particle{
  position:absolute; width:8px; height:8px;
  background:rgba(255,182,193,0.35);
  transform:rotate(45deg); border-radius:50%;
  animation-name:float; animation-timing-function:linear;
  animation-iteration-count:infinite;
  opacity:0; /* Mulai tersembunyi */
  animation-fill-mode:forwards; /* Pertahankan gaya akhir animasi */
}
@keyframes float{
  0%{transform:translate(0,0) rotate(45deg) scale(0.5);opacity:0;}
  20%{opacity:0.6;}
  80%{opacity:0.4;}
  100%{transform:translate(var(--x), var(--y)) rotate(45deg) scale(1.2);opacity:0;}
}

/* Navbar */
.navbar{
  position:fixed; top:0; left:0;
  width:100%;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(10px);
  display:flex; justify-content:center; align-items:center;
  padding:12px 0; z-index:1000;
  box-shadow:0 2px 15px rgba(0,0,0,0.1);
  display:none;
}
.navbar ul{
  list-style:none; display:flex; gap:35px; margin:0; padding:0;
}
.navbar button{
  background:none; border:none; color:white; font-size:1em;
  cursor:pointer; letter-spacing:1px; position:relative; transition:color 0.3s;
  font-weight:600;
}
.navbar button::after{
  content:''; position:absolute; left:0; bottom:-5px; width:0%; height:2px;
  background:#ffc0de; transition:width 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}
.navbar button:hover{ color:#ffe3f1; }
.navbar button:hover::after{ width:100%; }
.menu-toggle{ display:none; flex-direction:column; cursor:pointer; position:absolute; right:20px; top:14px; }
.menu-toggle span{ width:25px; height:3px; background:white; margin:4px 0; border-radius:2px; transition:0.3s; }
@media(max-width:700px){
  .navbar ul{ flex-direction:column; background:rgba(255,255,255,0.15);
    position:fixed; top:55px; right:-100%; width:60%; height:100vh;
    text-align:center; transition:right 0.4s ease; padding-top:60px;
    box-shadow:-5px 0 15px rgba(0,0,0,0.1);
  }
  .navbar ul.active{ right:0; }
  .menu-toggle{ display:flex; }
  .menu-toggle.active span:nth-child(1){ transform:rotate(-45deg) translate(-5px, 6px); }
  .menu-toggle.active span:nth-child(2){ opacity:0; }
  .menu-toggle.active span:nth-child(3){ transform:rotate(45deg) translate(-5px, -6px); }
}

/* Page */
.page{
  width:100%; height:100%;
  display:none; justify-content:center; align-items:center; flex-direction:column;
  opacity:0; transition:opacity 0.8s ease-in-out;
  position:absolute; top:0; left:0;
}
.active-page{ display:flex; opacity:1; }

/* Album */
.album-wrapper{ position:relative; text-align:center; width:90%; max-width:700px; z-index:2; opacity:0; transition:opacity 1.2s ease; }
.album-wrapper.show{ opacity:1; }
.folder-album-wrapper{ opacity:1; } /* Hilangkan efek fadeIn khusus album utama */
.romantic-text{ font-size:2em; margin-bottom:20px; text-shadow:0 0 20px rgba(255,255,255,0.6); color:#fff; font-weight:700; }
.album-container{
  position:relative; width:100%; height:650px;
  border-radius:25px; overflow:hidden;
  border:2px solid rgba(255,255,255,0.3);
  background:rgba(255,255,255,0.07);
  backdrop-filter:blur(12px);
  box-shadow:0 15px 35px rgba(0,0,0,0.3);
  touch-action:pan-x;
  display:flex; justify-content:center; align-items:center; /* Untuk centering loading spinner */
}
.photo{
  width:100%; height:100%; object-fit:cover; position:absolute; top:0; left:0;
  opacity:0; transition:opacity 1.3s ease-in-out, transform 1.3s ease-in-out, box-shadow 1.3s ease-in-out;
  border-radius:20px; box-shadow:0 0 0px rgba(255,192,222,0);
}
.photo.active{ opacity:1; z-index:2; transform:scale(1.03); box-shadow:0 0 40px rgba(255,192,222,0.6); }
.nav-btn{
  position:absolute; top:50%; transform:translateY(-50%);
  font-size:2em; color:white; background:rgba(255,255,255,0.2);
  border:none; border-radius:50%; width:50px; height:50px; cursor:pointer; z-index:3; transition:background 0.3s, transform 0.3s;
  display:flex; justify-content:center; align-items:center;
}
.nav-btn:hover{ background:rgba(255,255,255,0.4); transform:translateY(-50%) scale(1.1); }
.prev-btn{ left:10px; } .next-btn{ right:10px; }

/* Photo Indicator (Dots) */
.photo-indicator{
  display:flex; justify-content:center; margin-top:15px; gap:8px; z-index:4;
}
.dot{
  width:10px; height:10px; border-radius:50%; background:rgba(255,255,255,0.4);
  cursor:pointer; transition:all 0.3s; border:1px solid rgba(255,255,255,0.2);
}
.dot.active{
  background:#ffc0de; width:12px; height:12px;
  transform:scale(1.1); box-shadow:0 0 10px rgba(255,192,222,0.8);
}
.dot:hover{
  background:#ffb3d1; transform:scale(1.2);
}


/* Menu bawah foto */
.photo-menu{
  position:relative;
  margin-top:20px;
  display:flex; gap:20px; justify-content:center; background:rgba(255,255,255,0.15);
  padding:10px 20px; border-radius:25px; backdrop-filter:blur(10px); z-index:4;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
}
.photo-menu button{
  background:none; border:none; color:white; font-size:1em; cursor:pointer; transition:0.3s;
  position:relative; font-weight:600;
  display:flex; align-items:center; gap:5px;
}
.photo-menu button:hover{ color:#ffb3d1; transform:scale(1.05); }

/* Info Box */
.info-box{ background: rgba(255,255,255,0.08); backdrop-filter: blur(10px);
  padding:30px; border-radius:20px; color:#fff; text-align:center;
  box-shadow:0 15px 40px rgba(0,0,0,0.3); max-width:500px;
  animation: fadeInScale 0.8s forwards ease-out;
}
.info-box h2{ color:#ffe3f1; font-weight:700; margin-bottom:15px; }
.info-box p{ font-size:1.1em; margin-bottom:10px; }
.info-box a{ color:#ffc0de; text-decoration:none; font-weight:bold; }
.info-box a:hover{ text-decoration:underline; }

/* Login */
#loginPage{
  width:100%; height:100%; display:flex; justify-content:center; align-items:center;
  flex-direction:column; z-index:1000;
}
#loginTitle{
  color:#fff; font-size:2.5em; margin-bottom:25px; text-shadow:0 0 25px rgba(255,255,255,0.8); text-align:center;
  font-weight:700; animation: bounceIn 1s ease-out;
}
#loginBox{
  background:rgba(255,255,255,0.1); backdrop-filter:blur(12px);
  padding:40px 30px; border-radius:25px; box-shadow:0 15px 40px rgba(0,0,0,0.3);
  display:flex; flex-direction:column; gap:20px; width:300px; max-width:90%;
  animation: fadeInScale 0.8s forwards ease-out 0.2s; opacity:0;
}
#loginBox input{
  padding:14px 18px; border-radius:18px; border:1px solid rgba(255,255,255,0.3); outline:none;
  font-size:1em; background:rgba(255,255,255,0.2); color:white;
  transition:border-color 0.3s, background 0.3s;
}
#loginBox input::placeholder{ color:rgba(255,255,255,0.7); }
#loginBox input:focus{ border-color:#ffb3d1; background:rgba(255,255,255,0.3); }
#loginBox button{
  padding:14px; border:none; border-radius:18px;
  background:#ff99c7; color:white; font-weight:bold; cursor:pointer; transition:0.3s;
  font-size:1.1em; box-shadow:0 5px 15px rgba(0,0,0,0.2);
}
#loginBox button:hover{ background:#ffb3d1; transform:translateY(-2px); box-shadow:0 7px 20px rgba(0,0,0,0.3); }
.show-pass{
  position:relative; color:#fff; font-size:0.9em; cursor:pointer; text-align:right; margin-top:-10px;
  transition:color 0.3s;
}
.show-pass:hover{ color:#ffc0de; }
#loginError{color:#ffb3b3; font-size:0.9em; text-align:center; display:none; margin-top:-10px;}

/* Welcome Message */
#welcomeMessage{
  background:rgba(255,255,255,0.1); backdrop-filter:blur(12px);
  padding:30px; border-radius:20px; color:#fff; text-align:center;
  box-shadow:0 15px 40px rgba(0,0,0,0.3); max-width:400px;
  animation: fadeInScale 0.8s forwards ease-out; opacity:0;
  display:none; flex-direction:column; gap:20px;
}
#welcomeMessage h2{ font-size:2em; color:#ffe3f1; margin-bottom:10px; }
#welcomeMessage p{ font-size:1.1em; }
#welcomeMessage button{
  padding:12px 25px; border-radius:15px; border:none;
  background:#ff99c7; color:white; font-weight:bold; cursor:pointer; transition:0.3s;
  font-size:1em; box-shadow:0 5px 15px rgba(0,0,0,0.2);
}
#welcomeMessage button:hover{ background:#ffb3d1; transform:translateY(-2px); box-shadow:0 7px 20px rgba(0,0,0,0.3); }

/* Tombol Kembali */
.back-btn{
  position:fixed; top:20px; left:20px; z-index:100;
  padding:10px 15px; border-radius:10px; border:none;
  background:rgba(255,255,255,0.2); backdrop-filter:blur(5px);
  color:white; font-weight:bold; cursor:pointer; transition:0.3s, transform 0.3s;
  box-shadow:0 2px 10px rgba(0,0,0,0.1);
  display:flex; align-items:center; gap:5px;
}
.back-btn:hover{ background:rgba(255,255,255,0.4); transform:translateY(-2px); }

/* Tombol Folder */
.folder-btn{
  padding:18px 25px; border:none; border-radius:20px;
  background:#ff99c7; color:white; font-weight:bold; cursor:pointer; transition:0.3s;
  font-size:1.2em; letter-spacing:1px;
  box-shadow:0 5px 20px rgba(0,0,0,0.2);
  display:flex; justify-content:center; align-items:center;
  gap:10px;
  animation: fadeInScale 0.6s forwards ease-out; opacity:0;
}
.folder-btn:hover{ background:#ffb3d1 !important; transform:scale(1.03) translateY(-3px); box-shadow:0 8px 25px rgba(0,0,0,0.3); }
#folder1Btn{ animation-delay:0.2s; }
#folder2Btn{ animation-delay:0.4s; }

/* Loading Spinner */
.loading-spinner {
  border: 4px solid rgba(255, 255, 255, 0.3);
  border-top: 4px solid #ffc0de;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 1; /* Di bawah foto, tapi di atas container */
}
@keyframes spin {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  100% { transform: translate(-50%, -50%) rotate(360deg); }
}

/* Fallback Image Style */
.fallback-img {
    background-color: #f0f0f0;
    color: #888;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.2em;
    text-align: center;
    border-radius: 20px;
    border: 2px dashed #ccc;
    padding: 20px;
    box-sizing: border-box;
}


/* Animations */
@keyframes fadeInScale {
  0% { opacity: 0; transform: scale(0.9); }
  100% { opacity: 1; transform: scale(1); }
}
@keyframes bounceIn {
  0% { opacity: 0; transform: scale(0.3); }
  50% { opacity: 1; transform: scale(1.05); }
  70% { transform: scale(0.9); }
  100% { transform: scale(1); }
}

/* Responsive */
@media(max-width:600px){
  .romantic-text{ font-size:1.8em; margin-bottom:15px; }
  .album-container{ height:400px; border-radius:15px; }
  .photo{ border-radius:10px; }
  .nav-btn{ width:40px; height:40px; font-size:1.5em; }
  .prev-btn{ left:5px; } .next-btn{ right:5px; }
  .back-btn{ top:10px; left:10px; padding:8px 12px; font-size:0.9em; }
  #loginTitle{ font-size:2em; margin-bottom:20px; }
  #loginBox{ padding:30px 20px; }
  .folder-btn{ font-size:1em; padding:12px 20px; }
  .photo-menu{ margin-top:15px; padding:8px 15px; }
  .photo-menu button{ font-size:0.9em; }
  #welcomeMessage h2{ font-size:1.8em; }
  #welcomeMessage p{ font-size:1em; }
}

/* CHAT STYLING */
#chatPage .info-box {
    max-width: 600px;
    height: 80vh; 
    display: flex;
    flex-direction: column;
    padding: 0;
}
#chatHeader {
    padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.2); display: flex; align-items: center; gap: 15px; background: rgba(255,255,255,0.1);
    backdrop-filter: blur(8px);
}
#chatMessages {
    flex-grow: 1;
    overflow-y: auto;
    padding: 20px;
    background: rgba(255,255,255,0.05);
}
#chatMessages::-webkit-scrollbar {
    width: 6px;
}
#chatMessages::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.3);
    border-radius: 3px;
}
.chat-bubble {
    transition: all 0.3s ease;
}
.message-status {
    font-size: 1em !important; 
    margin-left: 3px; 
    vertical-align: middle;
}

/* Gambar dalam Chat */
.chat-image-preview {
    max-width: 100%;
    max-height: 200px;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 5px;
    display: block;
}
</style>
</head>
<body>

<div id="particleContainer"></div>

<nav class="navbar">
  <div class="menu-toggle" id="menuToggle"><span></span><span></span><span></span></div>
  <ul id="navMenu">
    <li><button id="homeBtn"><span class="material-icons">home</span> Home</button></li> <li><button id="chatNavBtn"><span class="material-icons">message</span> Chat</button></li> <li><button id="aboutBtn"><span class="material-icons">info</span> About</button></li> <li><button id="contactBtn"><span class="material-icons">email</span> Contact</button></li> 
    <li><button id="logoutNavBtn" style="color: #ffb3b3;"><span class="material-icons">logout</span> Logout</button></li>
  </ul>
</nav>

<div class="page active-page" id="loginPage">
  <div id="loginTitle">ğ—Ÿğ—¢ğ—šğ—œğ—¡ ğ—¨ğ—¡ğ—§ğ—¨ğ— ğ— ğ—˜ğ—Ÿğ—œğ—›ğ—”ğ—§ ğ—”ğ—Ÿğ—•ğ—¨ğ— </div>
  <div id="loginBox">
    <input type="text" id="username" placeholder="Username"> <input type="password" id="password" placeholder="Password"> <div class="show-pass" id="togglePass">Show Password</div>
    <button id="loginBtn">Login</button>
    <div id="loginError">Username atau Password salah!</div>
  </div>
</div>

<div class="page" id="welcomePage">
  <div id="welcomeMessage">
    <h2>Selamat Datang! âœ¨</h2>
    <p>Halo <span id="displayUsername"></span>, senang Anda kembali! Jelajahi momen spesial dalam album digital ini.</p>
    <button id="startBrowsingBtn">Mulai Jelajahi Album</button>
    <button id="logoutWelcomeBtn" style="background:#ff6666; margin-top:10px;">Logout</button>
  </div>
</div>

<div class="page" id="homePage">
  <div class="album-wrapper" id="folderSelectWrapper" style="display:flex; flex-direction:column; gap:20px; max-width:400px; padding:20px; opacity:1;">
    <div class="romantic-text" style="margin-bottom:0;">ğ—£ğ—œğ—Ÿğ—œğ—› ğ—™ğ—¢ğ—Ÿğ——ğ—˜ğ—¥ ğ—”ğ—Ÿğ—•ğ—¨ğ— </div>
    <button id="mainAlbumBtn" class="folder-btn">
        <span class="material-icons">favorite</span> ALBUM UTAMA
    </button>
    <button id="folder1Btn" class="folder-btn">
        <span class="material-icons">photo_album</span> PAP RANDOM 1
    </button>
    <button id="folder2Btn" class="folder-btn">
        <span class="material-icons">photo_album</span> PAP RANDOM 2 
    </button>
  </div>
  
  <div class="album-wrapper" id="albumWrapper" style="display:none;">
    <button class="back-btn" onclick="showPage('home')"><span class="material-icons">arrow_back</span> KEMBALI</button>
    <div class="romantic-text">ğ’ğ–ğˆğğ„ ğ”ğ—¡ğ—§ğ—¨ğ— ğ— ğ—˜ğ—Ÿğ—œğ—›ğ€ğ—§ ğ…ğ—¢ğ—§ğ—¢ ğ’ğ„ğ—Ÿğ—”ğ—¡ğ—ğ—¨ğ—§ğ—¡ğ—¬ğ—”</div>
    <div class="album-container" id="albumContainer">
      <div class="loading-spinner" id="mainSpinner"></div>
    </div>
    <div class="photo-indicator" id="mainPhotoIndicator"></div>
    <div class="photo-menu" id="photoMenu">
      <button id="shareBtn"><span class="material-icons">share</span> Share</button>
      <button id="likeBtn"><span class="material-icons">favorite_border</span> Like</button>
      <button id="downloadBtn"><span class="material-icons">download</span> Download</button>
    </div>
    <button class="nav-btn prev-btn" id="prevBtn">&#10094;</button>
    <button class="nav-btn next-btn" id="nextBtn">&#10095;</button>
  </div>
</div>

<div class="page" id="folder1Page">
  <button class="back-btn" onclick="showPage('home')"><span class="material-icons">arrow_back</span> KEMBALI</button>
  <div class="album-wrapper folder-album-wrapper" data-folder="folder1">
    <div class="romantic-text">ğ…ğğ‹ğƒğ„ğ‘ ğŸ - ğ’ğ–ğˆğğ„ ğ”ğ—¡ğ—§ğ—¨ğ— ğ— ğ—˜ğ—Ÿğ—œğ—›ğ€ğ—§ ğ…ğ—¢ğ—§ğ—¢</div>
    <div class="album-container folder-album-container" id="folder1Container">
      <div class="loading-spinner" id="folder1Spinner"></div>
    </div>
    <div class="photo-indicator folder-photo-indicator" id="folder1Indicator"></div>
    <div class="photo-menu">
      <button onclick="sharePhoto('folder1')"><span class="material-icons">share</span> Share</button>
      <button id="folder1LikeBtn" onclick="toggleLike('folder1')"><span class="material-icons">favorite_border</span> Like</button>
      <button onclick="downloadPhoto('folder1')"><span class="material-icons">download</span> Download</button>
    </div>
    <button class="nav-btn prev-btn" onclick="navPhoto('folder1', -1)">&#10094;</button>
    <button class="nav-btn next-btn" onclick="navPhoto('folder1', 1)">&#10095;</button>
  </div>
</div>

<div class="page" id="folder2Page">
  <button class="back-btn" onclick="showPage('home')"><span class="material-icons">arrow_back</span> KEMBALI</button>
  <div class="album-wrapper folder-album-wrapper" data-folder="folder2">
    <div class="romantic-text">ğ…ğğ‹ğƒğ„ğ‘ ğŸ - ğ’ğ–ğˆğğ„ ğ”ğ—¡ğ—§ğ—¨ğ— ğ— ğ—˜ğ—Ÿğ—œğ—›ğ€ğ—§ ğ…ğ—¢ğ—§ğ—¢</div>
    <div class="album-container folder-album-container" id="folder2Container">
      <div class="loading-spinner" id="folder2Spinner"></div>
    </div>
    <div class="photo-indicator folder-photo-indicator" id="folder2Indicator"></div>
    <div class="photo-menu">
      <button onclick="sharePhoto('folder2')"><span class="material-icons">share</span> Share</button>
      <button id="folder2LikeBtn" onclick="toggleLike('folder2')"><span class="material-icons">favorite_border</span> Like</button>
      <button onclick="downloadPhoto('folder2')"><span class="material-icons">download</span> Download</button>
    </div>
    <button class="nav-btn prev-btn" onclick="navPhoto('folder2', -1)">&#10094;</button>
    <button class="nav-btn next-btn" onclick="navPhoto('folder2', 1)">&#10095;</button>
  </div>
</div>

<div class="page" id="aboutPage">
  <button class="back-btn" onclick="showPage('home')"><span class="material-icons">arrow_back</span> KEMBALI</button>
  <div class="info-box">
    <h2>About</h2>
    <p>Developer: <strong>Nando Developers</strong></p>
    <p>ğ€ğ‹ğğ—¨ğ—  ğƒğ—œğ—šğ—œğ—§ğ€ğ‹ ğğ˜ ğ‚ğ„ğ—Ÿğ—­</p>
    <p>Versi: 3.2 FIX
  </div>
</div>

<div class="page" id="contactPage">
  <button class="back-btn" onclick="showPage('home')"><span class="material-icons">arrow_back</span> KEMBALI</button>
  <div class="info-box">
    <h2>Contact</h2>
    <p>Email: <a href="mailto:arcelbussines@email.com">arcelbussines@email.com</a></p>
    <p>Telegram: <a href="https://t.me/humans26" target="_blank">@humans26</a></p>
    <p>Jangan sungkan untuk menghubungi kami!</p>
  </div>
</div>

<div class="page" id="chatPage">
    <button class="back-btn" onclick="showPage('home')">
        <span class="material-icons">arrow_back</span> KEMBALI
    </button>
    <div class="info-box" style="max-width: 600px; height: 80vh; padding: 0; display: flex; flex-direction: column;">
        
        <div id="chatHeader" style="padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.2); display: flex; align-items: center; gap: 15px; background: rgba(255,255,255,0.1);">
            <div id="opponentAvatar" style="width: 40px; height: 40px; border-radius: 50%; background: #ffc0de; color: white; display: flex; justify-content: center; align-items: center; font-weight: 700; font-size: 1.2em;"></div>
            <div>
                <h3 id="opponentName" style="margin: 0; color: #ffe3f1; font-weight: 700; font-size: 1.2em;">Memuat...</h3>
                <p id="chatStatus" style="margin: 0; font-size: 0.8em; color: rgba(255,255,255,0.7);">Menghubungkan...</p>
            </div>
        </div>

        <div id="chatMessages" style="flex-grow: 1; overflow-y: auto; padding: 20px; text-align: left; display: flex; flex-direction: column; gap: 10px; scroll-behavior: smooth;">
            <div style="text-align: center; color: rgba(255,255,255,0.6); font-size: 0.8em;">-- Chat hanya berfungsi jika server backend berjalan di localhost:3000 --</div>
        </div>

        <div style="padding: 15px; border-top: 1px solid rgba(255,255,255,0.2); display: flex; gap: 10px; align-items: center;">
            <input type="file" id="mediaInput" accept="image/*" style="display: none;">
            
            <button id="mediaBtn" style="padding: 10px 15px; border-radius: 50%; width: 40px; height: 40px; background: #ffe3f1; color: #ff99c7; border: none; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center;">
                <span class="material-icons" style="font-size: 1.2em;">attach_file</span>
            </button>

            <input type="text" id="chatInput" placeholder="Ketik pesan..." style="flex-grow: 1; padding: 12px 18px; border-radius: 20px; border: none; background: rgba(255,255,255,0.5); color: #333; outline: none;">
            <button id="sendChatBtn" style="padding: 10px 15px; border-radius: 50%; width: 40px; height: 40px; background: #ff99c7; color: white; border: none; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center;">
                <span class="material-icons" style="font-size: 1.2em;">send</span>
            </button>
        </div>
    </div>
</div>

<audio id="bgMusic" src="https://h.top4top.io/m_35969emdf0.m4a" loop></audio>

<script>
// --- KONFIGURASI CHAT & LOGIN ---
const CHAT_SERVER_URL = 'http://localhost:3000'; 
const socket = io(CHAT_SERVER_URL); 

// 2 AKUN LOGIN STATIS
const loginCredentials = {
  'zaza': 'zaza',      
  'khirza': 'cantik'   
};
const CHAT_USER_PROFILES = {
    'zaza': { name: 'Zaza', isVerified: true, avatar: 'ZA' },
    'khirza': { name: 'Khirza', isVerified: false, avatar: 'KH' }
};

let myUserId = ''; 
let myUserName = '';
let opponentInfo = {}; 
// --- END KONFIGURASI BARU ---

// Navbar toggle
const navMenu = document.getElementById('navMenu');
const menuToggle = document.getElementById('menuToggle');
menuToggle.addEventListener('click',()=> {
  navMenu.classList.toggle('active');
  menuToggle.classList.toggle('active');
});

// Pages
const pages = { 
  login: document.getElementById('loginPage'), 
  welcome: document.getElementById('welcomePage'),
  home: document.getElementById('homePage'), 
  folder1: document.getElementById('folder1Page'),
  folder2: document.getElementById('folder2Page'),
  about: document.getElementById('aboutPage'), 
  contact: document.getElementById('contactPage'),
  chat: document.getElementById('chatPage')
};

// =========================================================================================
// DATA ALBUM FINAL
// =========================================================================================
const albumData = {
  main: { 
    photos: [
      "https://images2.imgbox.com/07/6d/flAblCPU_o.jpg",
      "https://images2.imgbox.com/8a/48/5WnFlheI_o.jpg",
      "https://images2.imgbox.com/17/93/x3zJwzr8_o.jpg",
      "https://images2.imgbox.com/9f/c4/0HZK3fj6_o.jpg",
      "https://images2.imgbox.com/d4/f3/y30RHo1v_o.jpg",
      "https://images2.imgbox.com/d0/ef/utCLLETK_o.jpg",
      "https://images2.imgbox.com/6d/9d/TfuuSkGT_o.jpg",
      "https://images2.imgbox.com/9b/14/1Nh4stjQ_o.jpg",
      "https://images2.imgbox.com/05/cf/2lmZVoK0_o.jpg",
      "https://images2.imgbox.com/17/ad/VpSegle2_o.jpg",
      "https://images2.imgbox.com/bf/38/j28lslL7_o.jpg",
      "https://images2.imgbox.com/2d/5d/THVip0wB_o.jpg",
      "https://images2.imgbox.box.com/d1/42/8VgLCjZp_o.jpg", // Link yang rusak di sini (perlu diubah jika gambar hilang)
      "https://images2.imgbox.com/15/a4/Aj6Q76RP_o.jpg",
      "https://images2.imgbox.com/31/7d/DaZ3wHmd_o.jpg",
      "https://images2.imgbox.com/ac/73/goBnuRIx_o.jpg",
      "https://images2.imgbox.com/aa/b9/HsnXJMTE_o.jpg",
      "https://images2.imgbox.com/9d/1e/44qSzju4_o.jpg",
      "https://images2.imgbox.com/94/ec/28ile6qy_o.jpg",
      "https://images2.imgbox.com/b7/2c/3EgN6c1L_o.jpg",
      "https://images2.imgbox.com/09/6a/BJdQjfwc_o.jpg",
      "https://images2.imgbox.com/7a/11/Example22_o.jpg"
    ], 
    current: 0, liked: false, 
    container: document.getElementById('albumContainer'), 
    indicator: document.getElementById('mainPhotoIndicator'), 
    spinner: document.getElementById('mainSpinner'),
    likeBtnElement: document.getElementById('likeBtn') 
  },
  folder1: { 
    photos: [ 
      "https://files.catbox.moe/a8103e.jpg",
      "https://files.catbox.moe/xrgsju.jpg",
      "https://files.catbox.moe/66gyub.jpg",
      "https://files.catbox.moe/kwhj0y.jpg",
      "https://files.catbox.moe/53xopd.jpg",
      "https://files.catbox.moe/vavwon.jpg",
      "https://files.catbox.moe/qs8hz8.jpg",
      "https://files.catbox.moe/vye5u2.jpg",
      "https://files.catbox.moe/62lajf.jpg",
      "https://files.catbox.moe/ieldvp.jpg"
    ], 
    current: 0, liked: false, 
    container: document.getElementById('folder1Container'), 
    indicator: document.getElementById('folder1Indicator'), 
    spinner: document.getElementById('folder1Spinner'),
    likeBtnElement: document.getElementById('folder1LikeBtn')
  },
  folder2: { 
    photos: [ 
      "https://files.catbox.moe/ieldvp.jpg",
      "https://files.catbox.moe/6ldfhh.jpg",
      "https://files.catbox.moe/250ug0.jpg",
      "https://files.catbox.moe/zklaxg.jpg",
      "https://files.catbox.moe/n5682x.jpg",
      "https://files.catbox.moe/rdgmp9.jpg"
    ], 
    current: 0, liked: false, 
    container: document.getElementById('folder2Container'), 
    indicator: document.getElementById('folder2Indicator'), 
    spinner: document.getElementById('folder2Spinner'),
    likeBtnElement: document.getElementById('folder2LikeBtn')
  }
};

let autoSwipeInterval;
let loggedInUsername = ''; 

// Login 
const loginBtn = document.getElementById('loginBtn');
const loginError = document.getElementById('loginError');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const togglePass = document.getElementById('togglePass');
const albumWrapper = document.getElementById('albumWrapper'); 
const folderSelectWrapper = document.getElementById('folderSelectWrapper');
const music = document.getElementById('bgMusic');
const displayUsername = document.getElementById('displayUsername');
const startBrowsingBtn = document.getElementById('startBrowsingBtn');

togglePass.addEventListener('click', ()=>{
  passwordInput.type = (passwordInput.type==='password')?'text':'password'; 
  togglePass.textContent = (passwordInput.type==='password')?'Show Password':'Hide Password'; 
});

loginBtn.addEventListener('click', ()=>{
  const user = usernameInput.value.trim();
  const pass = passwordInput.value.trim();
  
  if(loginCredentials[user] === pass){ 
    loginError.style.display='none';
    document.querySelector('.navbar').style.display='flex';
    
    myUserId = user; 
    myUserName = CHAT_USER_PROFILES[user].name;
    
    displayUsername.textContent = myUserName.toUpperCase(); 
    
    socket.emit('user_login', myUserId);
    
    showPage('welcome'); 
    clearInterval(autoSwipeInterval); 
  } else {
    loginError.style.display='block';
  }
});

startBrowsingBtn.addEventListener('click', () => {
  showPage('home'); 
});

// FUNGSI LOGOUT BARU
function logoutUser() {
    myUserId = '';
    myUserName = '';
    
    // Matikan musik
    music.pause();
    music.currentTime = 0;
    
    // Sembunyikan navbar
    document.querySelector('.navbar').style.display = 'none';
    
    // Kosongkan input login
    usernameInput.value = '';
    passwordInput.value = '';
    
    // Hentikan interval auto swipe
    clearInterval(autoSwipeInterval);
    
    // Kirim notifikasi logout ke server chat (opsional, tergantung implementasi server)
    // socket.emit('user_logout', myUserId); 
    
    // Tampilkan halaman login
    showPage('login');
}

document.getElementById('logoutWelcomeBtn').addEventListener('click', logoutUser);
document.getElementById('logoutNavBtn').addEventListener('click', logoutUser); // Tombol logout di Navbar


// FUNGSI UTAMA UNTUK MENAMPILKAN HALAMAN
function showPage(page){
  for(const key in pages){ 
    pages[key].style.display = 'none';
    pages[key].classList.remove('active-page');
  }

  if (page === 'home' || page === 'mainAlbum') {
      pages['home'].style.display = 'flex';
      pages['home'].classList.add('active-page');
      
      if (page === 'home') {
           folderSelectWrapper.style.display = 'flex'; 
           albumWrapper.style.display = 'none';
           clearInterval(autoSwipeInterval); 
      } else { 
           folderSelectWrapper.style.display = 'none';
           albumWrapper.style.display = 'block'; 
      }
  } else {
      pages[page].style.display = 'flex'; 
      pages[page].classList.add('active-page'); 
  }
  
  navMenu.classList.remove('active');
  menuToggle.classList.remove('active');

  if(page !== 'login' && page !== 'welcome' && page !== 'about' && page !== 'contact' && page !== 'chat') playMusicIfAlbum();
}


// =========================================================================================
// IMPLEMENTASI FUNGSI ALBUM
// =========================================================================================

/**
 * Menampilkan foto pada indeks tertentu.
 */
function showPhoto(folder, i) {
    const data = albumData[folder];
    if (!data || i < 0 || i >= data.photos.length) return;

    data.current = i; 

    // Hapus foto yang ada
    data.container.querySelectorAll('.photo').forEach(img => img.remove());
    
    const photoUrl = data.photos[i];
    const newPhoto = document.createElement('img');
    newPhoto.src = photoUrl;
    newPhoto.alt = `Photo ${i + 1}`;
    newPhoto.classList.add('photo');
    
    // Tampilkan spinner saat memuat
    data.spinner.style.display = 'block';

    newPhoto.onload = () => {
        data.spinner.style.display = 'none';
        // Tambahkan foto ke kontainer dan tampilkan
        data.container.appendChild(newPhoto); 
        setTimeout(() => {
            newPhoto.classList.add('active'); 
        }, 50);
        
        // Perbarui indikator dan like setelah foto dimuat
        updatePhotoIndicator(folder);
        updateLikeButton(data.likeBtnElement, data.liked);
        resetAutoSwipe(folder);

    };
    newPhoto.onerror = () => {
        data.spinner.style.display = 'none';
        
        // Buat elemen div untuk fallback
        const fallbackDiv = document.createElement('div');
        fallbackDiv.classList.add('fallback-img', 'photo', 'active');
        fallbackDiv.style.cssText = `
            width: 100%; height: 100%; position: absolute; top: 0; left: 0;
        `;
        fallbackDiv.innerHTML = `
            âŒ Foto ke-${i + 1} Gagal Dimuat. <br>
            <span style="font-size:0.8em; margin-top:5px; display:block;">Cek koneksi atau link.</span>
        `;
        
        data.container.appendChild(fallbackDiv);

        updatePhotoIndicator(folder);
        updateLikeButton(data.likeBtnElement, data.liked);
        resetAutoSwipe(folder);

        return; // Hentikan fungsi karena terjadi error
    };
    
    // Tambahkan foto ke kontainer sebelum dimuat (untuk memicu loading)
    if (!newPhoto.complete) { // Cek jika belum selesai dimuat
         data.container.appendChild(newPhoto); 
    }
}


/**
 * Navigasi ke foto sebelumnya atau berikutnya.
 */
function navPhoto(folder, direction) {
    const data = albumData[folder];
    if (!data || data.photos.length === 0) return;

    let newIndex = data.current + direction;
    if (newIndex < 0) {
        newIndex = data.photos.length - 1; 
    } else if (newIndex >= data.photos.length) {
        newIndex = 0; 
    }

    showPhoto(folder, newIndex);
}

/**
 * Memperbarui indikator (dots) di bawah foto.
 */
function updatePhotoIndicator(folder) {
    const data = albumData[folder];
    if (!data || !data.indicator) return;

    data.indicator.innerHTML = ''; 

    data.photos.forEach((_, index) => {
        const dot = document.createElement('div');
        dot.classList.add('dot');
        if (index === data.current) {
            dot.classList.add('active');
        }
        dot.addEventListener('click', () => showPhoto(folder, index));
        data.indicator.appendChild(dot);
    });
}

/**
 * Memulai penggeseran otomatis (Auto-Swipe).
 */
function startAutoSwipe(folder) {
    clearInterval(autoSwipeInterval);
    autoSwipeInterval = setInterval(() => {
        // Cek apakah halaman album yang bersangkutan sedang aktif
        const currentPage = Object.keys(pages).find(key => pages[key].classList.contains('active-page'));
        if (currentPage === folder || (currentPage === 'home' && folder === 'main')) {
             navPhoto(folder, 1);
        }
    }, 5000); // Ganti foto setiap 5 detik
}

/**
 * Mereset/Memulai ulang penggeseran otomatis.
 */
function resetAutoSwipe(folder) {
    clearInterval(autoSwipeInterval);
    startAutoSwipe(folder);
}

/**
 * Mengatur fungsi gesek (swipe) pada kontainer album.
 */
function setupSwipe(element, folder) {
    let startX;
    let threshold = 50; 

    element.removeEventListener('touchstart', element._touchstartListener);
    element.removeEventListener('touchmove', element._touchmoveListener);
    element.removeEventListener('touchend', element._touchendListener);
    
    element._touchstartListener = (e) => {
        startX = e.touches[0].clientX;
    };
    
    element._touchmoveListener = (e) => {
        if (Math.abs(e.touches[0].clientX - startX) > 10) {
            e.preventDefault(); 
        }
    };
    
    element._touchendListener = (e) => {
        const endX = e.changedTouches[0].clientX;
        const diffX = endX - startX;

        if (diffX > threshold) {
            navPhoto(folder, -1); // Swipe ke KANAN = PREV
        } else if (diffX < -threshold) {
            navPhoto(folder, 1); // Swipe ke KIRI = NEXT
        }
        resetAutoSwipe(folder); 
    };

    element.addEventListener('touchstart', element._touchstartListener);
    element.addEventListener('touchmove', element._touchmoveListener);
    element.addEventListener('touchend', element._touchendListener);
}

/**
 * Menginisialisasi Album Utama.
 */
function initMainAlbum() {
    const data = albumData.main;
    // Pastikan kontainer album bersih
    data.container.innerHTML = `<div class="loading-spinner" id="mainSpinner"></div>`;
    data.spinner = document.getElementById('mainSpinner'); 

    if (data.photos.length > 0) {
        showPhoto('main', data.current); // FIX: Memanggil showPhoto dengan argumen 'main'
        setupSwipe(data.container, 'main');
    } else {
        data.spinner.style.display = 'none';
        data.container.innerHTML = `<div class="fallback-img" style="font-size: 1.5em; height: 100%;">Album Utama Kosong</div>`;
        data.indicator.innerHTML = '';
        clearInterval(autoSwipeInterval);
    }
}

/**
 * Menginisialisasi Folder Album.
 */
function initFolderAlbum(folder) {
    const data = albumData[folder];
    
    // Safety check untuk memastikan elemen HTML terhubung
    data.container = document.getElementById(`${folder}Container`);
    data.indicator = document.getElementById(`${folder}Indicator`);
    data.spinner = document.getElementById(`${folder}Spinner`);
    data.likeBtnElement = document.getElementById(`${folder}LikeBtn`);
    
    if (!data || data.photos.length === 0) {
        data.container.innerHTML = `<div class="fallback-img" style="font-size: 1.5em; height: 100%;">Folder ${folder.slice(-1)} Kosong</div>`;
        data.indicator.innerHTML = '';
        clearInterval(autoSwipeInterval);
        return;
    }
    
    data.container.innerHTML = `<div class="loading-spinner" id="${folder}Spinner"></div>`;

    data.current = 0; 
    data.liked = false; 
    showPhoto(folder, 0);
    setupSwipe(data.container, folder);
}

/**
 * Memperbarui ikon tombol like.
 */
function updateLikeButton(button, isLiked) {
    if (button) {
        button.innerHTML = isLiked 
            ? '<span class="material-icons" style="color:#ffc0de;">favorite</span> Liked' 
            : '<span class="material-icons">favorite_border</span> Like';
    }
}

/**
 * Mengubah status like.
 */
function toggleLike(folder) {
    const data = albumData[folder];
    if (!data || !data.likeBtnElement) return;

    data.liked = !data.liked;
    updateLikeButton(data.likeBtnElement, data.liked);
    // alert(`Photo di ${folder} ${data.liked ? 'disukai' : 'batal disukai'}!`); // Opsional
}

/**
 * Simulasi fungsi share.
 */
function sharePhoto(folder) {
    const data = albumData[folder];
    if (!data || data.photos.length === 0) return;
    const currentPhotoUrl = data.photos[data.current];
    alert(`Berbagi tautan foto ini: ${currentPhotoUrl}`);
}

/**
 * Simulasi fungsi download.
 */
function downloadPhoto(folder) {
    const data = albumData[folder];
    if (!data || data.photos.length === 0) return;
    const currentPhotoUrl = data.photos[data.current];
    
    const link = document.createElement('a');
    link.href = currentPhotoUrl;
    link.download = `Khirza_Album_${folder}_${data.current + 1}.jpg`; 
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    alert(`Mendownload foto: Photo ${data.current + 1} dari ${folder}`);
}

// Event Listeners Album Utama
document.getElementById('shareBtn').onclick = () => sharePhoto('main');
document.getElementById('likeBtn').onclick = () => toggleLike('main');
document.getElementById('downloadBtn').onclick = () => downloadPhoto('main');
document.getElementById('prevBtn').onclick = () => navPhoto('main', -1);
document.getElementById('nextBtn').onclick = () => navPhoto('main', 1);

// Folder Selection Buttons
document.getElementById('mainAlbumBtn').onclick = ()=>{
    showPage('mainAlbum'); 
    initMainAlbum();
};
document.getElementById('folder1Btn').onclick = ()=>{
    showPage('folder1');
    initFolderAlbum('folder1');
};
document.getElementById('folder2Btn').onclick = ()=>{
    showPage('folder2');
    initFolderAlbum('folder2');
};

// Navbar buttons
const chatNavBtn = document.getElementById('chatNavBtn');
chatNavBtn.onclick=()=>showPage('chat');
document.getElementById('homeBtn').onclick=()=>showPage('home');
document.getElementById('aboutBtn').onclick=()=>showPage('about');
document.getElementById('contactBtn').onclick=()=>showPage('contact');

// Particle 
const particleContainer = document.getElementById('particleContainer');
function createParticle() {
  const particle = document.createElement('div');
  particle.classList.add('particle');
  const size = Math.random() * 5 + 3;
  particle.style.width = particle.style.height = `${size}px`;
  
  const x = Math.random() * 100;
  const y = Math.random() * 100;
  particle.style.left = `${x}vw`;
  particle.style.top = `${y}vh`;
  
  const duration = Math.random() * 10 + 5;
  const delay = Math.random() * 10;
  
  const endX = (Math.random() - 0.5) * 200 + 'px';
  const endY = (Math.random() - 0.5) * 200 + 'px';
  
  particle.style.setProperty('--x', endX);
  particle.style.setProperty('--y', endY);
  particle.style.animationDuration = `${duration}s`;
  particle.style.animationDelay = `${delay}s`;

  particleContainer.appendChild(particle);
}
for(let i=0;i<50;i++){ createParticle(); }


// Musik album
function playMusicIfAlbum(){
  music.play().catch(()=>{}); 
}
document.body.addEventListener('click', ()=>{ music.play(); }, {once:true});


// --- FUNGSI CHAT ---
const chatInput = document.getElementById('chatInput');
const sendChatBtn = document.getElementById('sendChatBtn');
const chatMessages = document.getElementById('chatMessages');
const chatStatus = document.getElementById('chatStatus');
const opponentNameEl = document.getElementById('opponentName');
const opponentAvatarEl = document.getElementById('opponentAvatar');
const mediaInput = document.getElementById('mediaInput'); // NEW
const mediaBtn = document.getElementById('mediaBtn');     // NEW

// Fungsi untuk membuka gambar di tab baru
function openImage(url) {
    window.open(url, '_blank');
}

function updateChatHeader(usersData) {
    const opponentId = myUserId === 'zaza' ? 'khirza' : 'zaza';
    opponentInfo = usersData[opponentId] || CHAT_USER_PROFILES[opponentId];
    
    if (opponentInfo) {
        opponentNameEl.innerHTML = opponentInfo.name + (opponentInfo.isVerified ? ' <span class="material-icons" style="font-size: 1em; color: #7aff7a; vertical-align: middle;">verified</span>' : '');
        opponentAvatarEl.textContent = opponentInfo.avatar;
    }
}

function addMessageToChat(data, isHistory = false) {
    const { message, timestamp, senderId, status } = data;
    const isMe = senderId === myUserId;
    const timeDisplay = timestamp || new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
    
    // Cek apakah pesan adalah format gambar (NEW)
    const imageMatch = message.match(/^\[GAMBAR: (.*?)\]$/);
    let messageContent = message;

    const msgDiv = document.createElement('div');
    msgDiv.classList.add('chat-bubble');
    msgDiv.id = `msg-${data.id || Date.now()}`;

    // Inline CSS untuk gelembung chat
    msgDiv.style.cssText = `
        max-width: 80%;
        padding: 10px 15px;
        border-radius: 15px;
        color: ${isMe ? 'white' : '#333'};
        word-wrap: break-word;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        font-size: 0.95em;
        line-height: 1.4;
        align-self: ${isMe ? 'flex-end' : 'flex-start'};
        background: ${isMe ? '#ff99c7' : 'rgba(255,255,255,0.85)'};
        border-bottom-${isMe ? 'right' : 'left'}-radius: 0;
    `;
    
    if (imageMatch) {
        const imageUrl = imageMatch[1];
        // Konten Pesan adalah Gambar
        messageContent = `
            <span style="font-style: italic; color: ${isMe ? 'white' : '#777'}; display: block;">
                ${isMe ? 'Anda mengirim gambar' : 'Gambar'}
            </span>
            <img src="${imageUrl}" class="chat-image-preview" onclick="openImage('${imageUrl}')" alt="Gambar Terkirim">
        `;
    }

    // Konten Pesan + Jam + Status (Centang)
    msgDiv.innerHTML = `
        ${messageContent}
        <span style="display: block; font-size: 0.75em; margin-top: 5px; text-align: right; color: ${isMe ? 'rgba(255,255,255,0.8)' : 'rgba(0,0,0,0.6)'};">
            ${timeDisplay}
            ${isMe ? `<span class="material-icons message-status" data-id="${data.id || Date.now()}" style="font-size: 1em; margin-left: 3px; vertical-align: middle; color: ${status === 'read' ? '#00e676' : 'rgba(255,255,255,0.8)'};">${status === 'read' ? 'done_all' : (status === 'sent' ? 'done_all' : 'schedule')}</span>` : ''}
        </span>
    `;

    chatMessages.appendChild(msgDiv);
    if (!isHistory) chatMessages.scrollTop = chatMessages.scrollHeight;
}

function updateMessageStatus(data) {
    const statusIcon = document.querySelector(`.message-status[data-id="${data.id}"]`);
    if (statusIcon) {
        if (data.status === 'read') {
            statusIcon.textContent = 'done_all';
            statusIcon.style.color = '#00e676';
        } else if (data.status === 'sent') {
            statusIcon.textContent = 'done_all';
            statusIcon.style.color = 'rgba(255,255,255,0.8)';
        }
    }
}

// --- SOCKET LISTENERS ---
socket.on('load_users', (usersData) => { updateChatHeader(usersData); });
socket.on('load_history', (history) => {
    chatMessages.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.6); font-size: 0.8em;">-- Chat hanya berfungsi jika server backend berjalan di localhost:3000 --</div>';
    history.forEach(msg => addMessageToChat(msg, true));
    chatMessages.scrollTop = chatMessages.scrollHeight;
});
socket.on('receive_message', (data) => { addMessageToChat(data); });
socket.on('update_status', (data) => { updateMessageStatus(data); });
socket.on('user_status_update', (onlineIds) => {
    const opponentId = myUserId === 'zaza' ? 'khirza' : 'zaza';
    
    if (onlineIds.includes(opponentId)) {
        chatStatus.textContent = 'Online âœ¨';
        chatStatus.style.color = '#7aff7a';
    } else {
        chatStatus.textContent = 'Offline ğŸ˜´';
        chatStatus.style.color = '#ffc0de';
    }
});

// --- EVENT HANDLER CHAT INPUT ---
sendChatBtn.addEventListener('click', () => {
    const message = chatInput.value.trim();
    if (message !== '' && myUserId) {
        socket.emit('send_message', {
            senderId: myUserId,
            message: message,
        });
        chatInput.value = '';
    }
});
chatInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendChatBtn.click();
});

// --- FUNGSI KIRIM MEDIA BARU ---
mediaBtn.addEventListener('click', () => {
    mediaInput.click(); // Memicu klik pada input file tersembunyi
});

mediaInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file && myUserId) {
        // Karena ini adalah simulasi, kita akan membuat URL objek lokal
        const imageUrl = URL.createObjectURL(file);
        
        // Kirim pesan dengan format khusus untuk gambar
        const imageMessage = `[GAMBAR: ${imageUrl}]`;
        
        socket.emit('send_message', {
            senderId: myUserId,
            message: imageMessage,
        });
        
        // Reset input file agar event change dapat dipicu lagi
        mediaInput.value = null; 
        alert("Gambar berhasil dikirim (simulasi). Di dunia nyata, ini akan diunggah ke server.");
    }
});

// Jalankan inisialisasi awal untuk album utama, meskipun tidak aktif, untuk memastikan elemen dimuat
initMainAlbum();
</script>
</body>
</html>
