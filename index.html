<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Album Digital Khirza - Premium Glow V3.2 FINAL (APPENDED)</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
/* Reset & Global */
html, body {
  margin:0; padding:0;
  font-family:'Poppins',sans-serif;
  height:100%; width:100%;
  overflow:hidden; /* Pastikan tidak ada scrollbar utama */
  background:linear-gradient(135deg,#ffd6e8,#ffb3d1,#ff99c7);
  display:flex; justify-content:center; align-items:center;
  color:#333; /* Warna teks default */
  line-height:1.6;
}

/* Particle Background */
#particleContainer{
  position:fixed; top:0; left:0;
  width:100%; height:100%;
  pointer-events:none;
  overflow:hidden; z-index:0;
}
.particle{
  position:absolute; width:8px; height:8px;
  background:rgba(255,182,193,0.35);
  transform:rotate(45deg); border-radius:50%;
  animation-name:float; animation-timing-function:linear;
  animation-iteration-count:infinite;
  opacity:0; /* Mulai tersembunyi */
  animation-fill-mode:forwards; /* Pertahankan gaya akhir animasi */
}
@keyframes float{
  0%{transform:translate(0,0) rotate(45deg) scale(0.5);opacity:0;}
  20%{opacity:0.6;}
  80%{opacity:0.4;}
  100%{transform:translate(var(--x), var(--y)) rotate(45deg) scale(1.2);opacity:0;}
}

/* Navbar */
.navbar{
  position:fixed; top:0; left:0;
  width:100%;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(10px);
  display:flex; justify-content:center; align-items:center;
  padding:12px 0; z-index:1000;
  box-shadow:0 2px 15px rgba(0,0,0,0.1);
  display:none;
}
.navbar ul{
  list-style:none; display:flex; gap:35px; margin:0; padding:0;
}
.navbar button{
  background:none; border:none; color:white; font-size:1em;
  cursor:pointer; letter-spacing:1px; position:relative; transition:color 0.3s;
  font-weight:600;
}
.navbar button::after{
  content:''; position:absolute; left:0; bottom:-5px; width:0%; height:2px;
  background:#ffc0de; transition:width 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}
.navbar button:hover{ color:#ffe3f1; }
.navbar button:hover::after{ width:100%; }
.menu-toggle{ display:none; flex-direction:column; cursor:pointer; position:absolute; right:20px; top:14px; }
.menu-toggle span{ width:25px; height:3px; background:white; margin:4px 0; border-radius:2px; transition:0.3s; }
@media(max-width:700px){
  .navbar ul{ flex-direction:column; background:rgba(255,255,255,0.15);
    position:fixed; top:55px; right:-100%; width:60%; height:100vh;
    text-align:center; transition:right 0.4s ease; padding-top:60px;
    box-shadow:-5px 0 15px rgba(0,0,0,0.1);
  }
  .navbar ul.active{ right:0; }
  .menu-toggle{ display:flex; }
  .menu-toggle.active span:nth-child(1){ transform:rotate(-45deg) translate(-5px, 6px); }
  .menu-toggle.active span:nth-child(2){ opacity:0; }
  .menu-toggle.active span:nth-child(3){ transform:rotate(45deg) translate(-5px, -6px); }
}

/* Page */
.page{
  width:100%; height:100%;
  display:none; justify-content:center; align-items:center; flex-direction:column;
  opacity:0; transition:opacity 0.8s ease-in-out;
  position:absolute; top:0; left:0;
}
.active-page{ display:flex; opacity:1; }

/* Album */
.album-wrapper{ position:relative; text-align:center; width:90%; max-width:700px; z-index:2; opacity:0; transition:opacity 1.2s ease; }
.album-wrapper.show{ opacity:1; }
.folder-album-wrapper{ opacity:1; } /* Hilangkan efek fadeIn khusus album utama */
.romantic-text{ font-size:2em; margin-bottom:20px; text-shadow:0 0 20px rgba(255,255,255,0.6); color:#fff; font-weight:700; }
.album-container{
  position:relative; width:100%; height:650px;
  border-radius:25px; overflow:hidden;
  border:2px solid rgba(255,255,255,0.3);
  background:rgba(255,255,255,0.07);
  backdrop-filter:blur(12px);
  box-shadow:0 15px 35px rgba(0,0,0,0.3);
  touch-action:pan-x;
  display:flex; justify-content:center; align-items:center; /* Untuk centering loading spinner */
}
.photo{
  width:100%; height:100%; object-fit:cover; position:absolute; top:0; left:0;
  opacity:0; transition:opacity 1.3s ease-in-out, transform 1.3s ease-in-out, box-shadow 1.3s ease-in-out;
  border-radius:20px; box-shadow:0 0 0px rgba(255,192,222,0);
}
.photo.active{ opacity:1; z-index:2; transform:scale(1.03); box-shadow:0 0 40px rgba(255,192,222,0.6); }
.nav-btn{
  position:absolute; top:50%; transform:translateY(-50%);
  font-size:2em; color:white; background:rgba(255,255,255,0.2);
  border:none; border-radius:50%; width:50px; height:50px; cursor:pointer; z-index:3; transition:background 0.3s, transform 0.3s;
  display:flex; justify-content:center; align-items:center;
}
.nav-btn:hover{ background:rgba(255,255,255,0.4); transform:translateY(-50%) scale(1.1); }
.prev-btn{ left:10px; } .next-btn{ right:10px; }

/* Photo Indicator (Dots) */
.photo-indicator{
  display:flex; justify-content:center; margin-top:15px; gap:8px; z-index:4;
}
.dot{
  width:10px; height:10px; border-radius:50%; background:rgba(255,255,255,0.4);
  cursor:pointer; transition:all 0.3s; border:1px solid rgba(255,255,255,0.2);
}
.dot.active{
  background:#ffc0de; width:12px; height:12px;
  transform:scale(1.1); box-shadow:0 0 10px rgba(255,192,222,0.8);
}
.dot:hover{
  background:#ffb3d1; transform:scale(1.2);
}


/* Menu bawah foto */
.photo-menu{
  position:relative;
  margin-top:20px;
  display:flex; gap:20px; justify-content:center; background:rgba(255,255,255,0.15);
  padding:10px 20px; border-radius:25px; backdrop-filter:blur(10px); z-index:4;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
}
.photo-menu button{
  background:none; border:none; color:white; font-size:1em; cursor:pointer; transition:0.3s;
  position:relative; font-weight:600;
  display:flex; align-items:center; gap:5px;
}
.photo-menu button:hover{ color:#ffb3d1; transform:scale(1.05); }

/* Info Box */
.info-box{ background: rgba(255,255,255,0.08); backdrop-filter: blur(10px);
  padding:30px; border-radius:20px; color:#fff; text-align:center;
  box-shadow:0 15px 40px rgba(0,0,0,0.3); max-width:500px;
  animation: fadeInScale 0.8s forwards ease-out;
}
.info-box h2{ color:#ffe3f1; font-weight:700; margin-bottom:15px; }
.info-box p{ font-size:1.1em; margin-bottom:10px; }
.info-box a{ color:#ffc0de; text-decoration:none; font-weight:bold; }
.info-box a:hover{ text-decoration:underline; }

/* Login */
#loginPage{
  width:100%; height:100%; display:flex; justify-content:center; align-items:center;
  flex-direction:column; z-index:1000;
}
#loginTitle{
  color:#fff; font-size:2.5em; margin-bottom:25px; text-shadow:0 0 25px rgba(255,255,255,0.8); text-align:center;
  font-weight:700; animation: bounceIn 1s ease-out;
}
#loginBox{
  background:rgba(255,255,255,0.1); backdrop-filter:blur(12px);
  padding:40px 30px; border-radius:25px; box-shadow:0 15px 40px rgba(0,0,0,0.3);
  display:flex; flex-direction:column; gap:20px; width:300px; max-width:90%;
  animation: fadeInScale 0.8s forwards ease-out 0.2s; opacity:0;
}
#loginBox input{
  padding:14px 18px; border-radius:18px; border:1px solid rgba(255,255,255,0.3); outline:none;
  font-size:1em; background:rgba(255,255,255,0.2); color:white;
  transition:border-color 0.3s, background 0.3s;
}
#loginBox input::placeholder{ color:rgba(255,255,255,0.7); }
#loginBox input:focus{ border-color:#ffb3d1; background:rgba(255,255,255,0.3); }
#loginBox button{
  padding:14px; border:none; border-radius:18px;
  background:#ff99c7; color:white; font-weight:bold; cursor:pointer; transition:0.3s;
  font-size:1.1em; box-shadow:0 5px 15px rgba(0,0,0,0.2);
}
#loginBox button:hover{ background:#ffb3d1; transform:translateY(-2px); box-shadow:0 7px 20px rgba(0,0,0,0.3); }
.show-pass{
  position:relative; color:#fff; font-size:0.9em; cursor:pointer; text-align:right; margin-top:-10px;
  transition:color 0.3s;
}
.show-pass:hover{ color:#ffc0de; }
#loginError{color:#ffb3b3; font-size:0.9em; text-align:center; display:none; margin-top:-10px;}

/* Welcome Message */
#welcomeMessage{
  background:rgba(255,255,255,0.1); backdrop-filter:blur(12px);
  padding:30px; border-radius:20px; color:#fff; text-align:center;
  box-shadow:0 15px 40px rgba(0,0,0,0.3); max-width:400px;
  animation: fadeInScale 0.8s forwards ease-out; opacity:0;
  display:none; flex-direction:column; gap:20px;
}
#welcomeMessage h2{ font-size:2em; color:#ffe3f1; margin-bottom:10px; }
#welcomeMessage p{ font-size:1.1em; }
#welcomeMessage button{
  padding:12px 25px; border-radius:15px; border:none;
  background:#ff99c7; color:white; font-weight:bold; cursor:pointer; transition:0.3s;
  font-size:1em; box-shadow:0 5px 15px rgba(0,0,0,0.2);
}
#welcomeMessage button:hover{ background:#ffb3d1; transform:translateY(-2px); box-shadow:0 7px 20px rgba(0,0,0,0.3); }

/* Tombol Kembali */
.back-btn{
  position:fixed; top:20px; left:20px; z-index:100;
  padding:10px 15px; border-radius:10px; border:none;
  background:rgba(255,255,255,0.2); backdrop-filter:blur(5px);
  color:white; font-weight:bold; cursor:pointer; transition:0.3s, transform 0.3s;
  box-shadow:0 2px 10px rgba(0,0,0,0.1);
  display:flex; align-items:center; gap:5px;
}
.back-btn:hover{ background:rgba(255,255,255,0.4); transform:translateY(-2px); }

/* Tombol Folder */
.folder-btn{
  padding:18px 25px; border:none; border-radius:20px;
  background:#ff99c7; color:white; font-weight:bold; cursor:pointer; transition:0.3s;
  font-size:1.2em; letter-spacing:1px;
  box-shadow:0 5px 20px rgba(0,0,0,0.2);
  display:flex; justify-content:center; align-items:center;
  gap:10px;
  animation: fadeInScale 0.6s forwards ease-out; opacity:0;
}
.folder-btn:hover{ background:#ffb3d1 !important; transform:scale(1.03) translateY(-3px); box-shadow:0 8px 25px rgba(0,0,0,0.3); }
#folder1Btn{ animation-delay:0.2s; }
#folder2Btn{ animation-delay:0.4s; }

/* Loading Spinner */
.loading-spinner {
  border: 4px solid rgba(255, 255, 255, 0.3);
  border-top: 4px solid #ffc0de;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 1; /* Di bawah foto, tapi di atas container */
}
@keyframes spin {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  100% { transform: translate(-50%, -50%) rotate(360deg); }
}

/* Fallback Image Style */
.fallback-img {
    background-color: #f0f0f0;
    color: #888;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.2em;
    text-align: center;
    border-radius: 20px;
    border: 2px dashed #ccc;
}


/* Animations */
@keyframes fadeInScale {
  0% { opacity: 0; transform: scale(0.9); }
  100% { opacity: 1; transform: scale(1); }
}
@keyframes bounceIn {
  0% { opacity: 0; transform: scale(0.3); }
  50% { opacity: 1; transform: scale(1.05); }
  70% { transform: scale(0.9); }
  100% { transform: scale(1); }
}

/* Responsive */
@media(max-width:600px){
  .romantic-text{ font-size:1.8em; margin-bottom:15px; }
  .album-container{ height:400px; border-radius:15px; }
  .photo{ border-radius:10px; }
  .nav-btn{ width:40px; height:40px; font-size:1.5em; }
  .prev-btn{ left:5px; } .next-btn{ right:5px; }
  .back-btn{ top:10px; left:10px; padding:8px 12px; font-size:0.9em; }
  #loginTitle{ font-size:2em; margin-bottom:20px; }
  #loginBox{ padding:30px 20px; }
  .folder-btn{ font-size:1em; padding:12px 20px; }
  .photo-menu{ margin-top:15px; padding:8px 15px; }
  .photo-menu button{ font-size:0.9em; }
  #welcomeMessage h2{ font-size:1.8em; }
  #welcomeMessage p{ font-size:1em; }
}

/* PENAMBAHAN 4: CHAT STYLING (Di Akhir CSS) */
#chatPage .info-box {
    max-width: 600px;
    height: 80vh; 
    display: flex;
    flex-direction: column;
    padding: 0;
}
#chatHeader {
    padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.2); display: flex; align-items: center; gap: 15px; background: rgba(255,255,255,0.1);
    backdrop-filter: blur(8px);
}
#chatMessages {
    flex-grow: 1;
    overflow-y: auto;
    padding: 20px;
    background: rgba(255,255,255,0.05);
}
#chatMessages::-webkit-scrollbar {
    width: 6px;
}
#chatMessages::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.3);
    border-radius: 3px;
}
.chat-bubble {
    transition: all 0.3s ease;
}
.message-status {
    font-size: 1em !important; 
    margin-left: 3px; 
    vertical-align: middle;
}
</style>
</head>
<body>

<div id="particleContainer"></div>

<nav class="navbar">
  <div class="menu-toggle" id="menuToggle"><span></span><span></span><span></span></div>
  <ul id="navMenu">
    <li><button id="homeBtn"><span class="material-icons">home</span> Home</button></li> <li><button id="chatNavBtn"><span class="material-icons">message</span> Chat</button></li> <li><button id="aboutBtn"><span class="material-icons">info</span> About</button></li> <li><button id="contactBtn"><span class="material-icons">email</span> Contact</button></li> </ul>
</nav>

<div class="page active-page" id="loginPage">
  <div id="loginTitle">ğ—Ÿğ—¢ğ—šğ—œğ—¡ ğ—¨ğ—¡ğ—§ğ—¨ğ— ğ— ğ—˜ğ—Ÿğ—œğ—›ğ—”ğ—§ ğ—”ğ—Ÿğ—•ğ—¨ğ— </div>
  <div id="loginBox">
    <input type="text" id="username" placeholder="Username (zaza / khirza)"> <input type="password" id="password" placeholder="Password (zaza / cantik)"> <div class="show-pass" id="togglePass">Show Password</div>
    <button id="loginBtn">Login</button>
    <div id="loginError">Username atau Password salah!</div>
  </div>
</div>

<div class="page" id="welcomePage">
  <div id="welcomeMessage">
    <h2>Selamat Datang! âœ¨</h2>
    <p>Halo <span id="displayUsername"></span>, senang Anda kembali! Jelajahi momen spesial dalam album digital ini.</p>
    <button id="startBrowsingBtn">Mulai Jelajahi Album</button>
  </div>
</div>

<div class="page" id="homePage">
  <div class="album-wrapper" id="folderSelectWrapper" style="display:flex; flex-direction:column; gap:20px; max-width:400px; padding:20px; opacity:1;">
    <div class="romantic-text" style="margin-bottom:0;">ğ—£ğ—œğ—Ÿğ—œğ—› ğ—™ğ—¢ğ—Ÿğ——ğ—˜ğ—¥ ğ—”ğ—Ÿğ—•ğ—¨ğ— </div>
    <button id="mainAlbumBtn" class="folder-btn">
        <span class="icon"></span> ALBUM UTAMA
    </button>
    <button id="folder1Btn" class="folder-btn">
        <span class="icon"></span> PAP RANDOM 1
    </button>
    <button id="folder2Btn" class="folder-btn">
        <span class="icon"></span> PAP RANDOM 2 
    </button>
  </div>
  
  <div class="album-wrapper" id="albumWrapper" style="display:none;">
    <button class="back-btn" onclick="showPage('home')">&#10094; KEMBALI</button>
    <div class="romantic-text">ğ’ğ–ğˆğğ„ ğ”ğ—¡ğ—§ğ—¨ğ— ğ— ğ—˜ğ—Ÿğˆğ—›ğ€ğ—§ ğ…ğ—¢ğ—§ğ—¢ ğ’ğ„ğ—Ÿğ—”ğ—¡ğ—ğ”ğ“ğ—¡ğ—¬ğ€</div>
    <div class="album-container" id="albumContainer">
      <div class="loading-spinner" id="mainSpinner"></div>
    </div>
    <div class="photo-indicator" id="mainPhotoIndicator"></div>
    <div class="photo-menu" id="photoMenu">
      <button id="shareBtn"><span class="icon"></span> Share</button>
      <button id="likeBtn"><span class="icon"></span> Like</button>
      <button id="downloadBtn"><span class="icon"></span> Download</button>
    </div>
    <button class="nav-btn prev-btn" id="prevBtn">&#10094;</button>
    <button class="nav-btn next-btn" id="nextBtn">&#10095;</button>
  </div>
</div>

<div class="page" id="folder1Page">
  <button class="back-btn" onclick="showPage('home')">&#10094; KEMBALI</button>
  <div class="album-wrapper folder-album-wrapper" data-folder="folder1">
    <div class="romantic-text">ğ…ğğ‹ğƒğ„ğ‘ ğŸ - ğ’ğ–ğˆğğ„ ğ”ğ—¡ğ—§ğ—¨ğ— ğ— ğ—˜ğ—Ÿğ—œğ—›ğ€ğ—§ ğ…ğ—¢ğ—§ğ—¢</div>
    <div class="album-container folder-album-container">
      <div class="loading-spinner" id="folder1Spinner"></div>
    </div>
    <div class="photo-indicator folder-photo-indicator"></div>
    <div class="photo-menu">
      <button onclick="sharePhoto('folder1')"><span class="icon"></span> Share</button>
      <button onclick="toggleLike('folder1')"><span class="icon"></span> Like</button>
      <button onclick="downloadPhoto('folder1')"><span class="icon"></span> Download</button>
    </div>
    <button class="nav-btn prev-btn" onclick="navPhoto('folder1', -1)">&#10094;</button>
    <button class="nav-btn next-btn" onclick="navPhoto('folder1', 1)">&#10095;</button>
  </div>
</div>

<div class="page" id="folder2Page">
  <button class="back-btn" onclick="showPage('home')">&#10094; KEMBALI</button>
  <div class="album-wrapper folder-album-wrapper" data-folder="folder2">
    <div class="romantic-text">ğ…ğğ‹ğƒğ„ğ‘ ğŸ - ğ’ğ–ğˆğğ„ ğ”ğ—¡ğ—§ğ—¨ğ— ğ— ğ—˜ğ—Ÿğ—œğ—›ğ€ğ—§ ğ…ğ—¢ğ—§ğ—¢</div>
    <div class="album-container folder-album-container">
      <div class="loading-spinner" id="folder2Spinner"></div>
    </div>
    <div class="photo-indicator folder-photo-indicator"></div>
    <div class="photo-menu">
      <button onclick="sharePhoto('folder2')"><span class="icon"></span> Share</button>
      <button onclick="toggleLike('folder2')"><span class="icon"></span> Like</button>
      <button onclick="downloadPhoto('folder2')"><span class="icon"></span> Download</button>
    </div>
    <button class="nav-btn prev-btn" onclick="navPhoto('folder2', -1)">&#10094;</button>
    <button class="nav-btn next-btn" onclick="navPhoto('folder2', 1)">&#10095;</button>
  </div>
</div>

<div class="page" id="aboutPage">
  <button class="back-btn" onclick="showPage('home')">&#10094; KEMBALI</button>
  <div class="info-box">
    <h2>About</h2>
    <p>Developer: <strong>Nando Developers</strong></p>
    <p>ğ€ğ‹ğğ—¨ğ—  ğƒğˆğ—šğ—œğ“ğ€ğ‹ ğğ˜ ğ‚ğ„ğ—Ÿğ—­</p>
    <p>Versi: 1.2
  </div>
</div>

<div class="page" id="contactPage">
  <button class="back-btn" onclick="showPage('home')">&#10094; KEMBALI</button>
  <div class="info-box">
    <h2>Contact</h2>
    <p>Email: <a href="mailto:arcelbussines@email.com">arcelbussines@email.com</a></p>
    <p>Telegram: <a href="https://t.me/humans26" target="_blank">@humans26</a></p>
    <p>Jangan sungkan untuk menghubungi kami!</p>
  </div>
</div>

<div class="page" id="chatPage">
    <button class="back-btn" onclick="showPage('home')">
        <span class="material-icons">arrow_back</span> KEMBALI
    </button>
    <div class="info-box" style="max-width: 600px; height: 80vh; padding: 0; display: flex; flex-direction: column;">
        
        <div id="chatHeader" style="padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.2); display: flex; align-items: center; gap: 15px; background: rgba(255,255,255,0.1);">
            <div id="opponentAvatar" style="width: 40px; height: 40px; border-radius: 50%; background: #ffc0de; color: white; display: flex; justify-content: center; align-items: center; font-weight: 700; font-size: 1.2em;"></div>
            <div>
                <h3 id="opponentName" style="margin: 0; color: #ffe3f1; font-weight: 700; font-size: 1.2em;">Memuat...</h3>
                <p id="chatStatus" style="margin: 0; font-size: 0.8em; color: rgba(255,255,255,0.7);">Menghubungkan...</p>
            </div>
        </div>

        <div id="chatMessages" style="flex-grow: 1; overflow-y: auto; padding: 20px; text-align: left; display: flex; flex-direction: column; gap: 10px; scroll-behavior: smooth;">
            <div style="text-align: center; color: rgba(255,255,255,0.6); font-size: 0.8em;">-- Chat hanya berfungsi jika server backend berjalan di localhost:3000 --</div>
        </div>

        <div style="padding: 15px; border-top: 1px solid rgba(255,255,255,0.2); display: flex; gap: 10px; align-items: center;">
            <input type="text" id="chatInput" placeholder="Ketik pesan..." style="flex-grow: 1; padding: 12px 18px; border-radius: 20px; border: none; background: rgba(255,255,255,0.5); color: #333; outline: none;">
            <button id="sendChatBtn" style="padding: 10px 15px; border-radius: 50%; width: 40px; height: 40px; background: #ff99c7; color: white; border: none; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center;">
                <span class="material-icons" style="font-size: 1.2em;">send</span>
            </button>
        </div>
    </div>
</div>

<audio id="bgMusic" src="https://h.top4top.io/m_35969emdf0.m4a" loop></audio>

<script>
// --- KONFIGURASI CHAT & LOGIN (BARU) ---
const CHAT_SERVER_URL = 'http://localhost:3000'; 
const socket = io(CHAT_SERVER_URL); 

// 2 AKUN LOGIN STATIS (HARUS SESUAI DENGAN SERVER.JS)
const loginCredentials = {
  'zaza': 'zaza',      
  'khirza': 'cantik'   
};
const CHAT_USER_PROFILES = {
    'zaza': { name: 'Zaza', isVerified: true, avatar: 'ZA' },
    'khirza': { name: 'Khirza', isVerified: false, avatar: 'KH' }
};

let myUserId = ''; 
let myUserName = '';
let opponentInfo = {}; 
// --- END KONFIGURASI BARU ---

// Navbar toggle
const navMenu = document.getElementById('navMenu');
const menuToggle = document.getElementById('menuToggle');
menuToggle.addEventListener('click',()=> {
  navMenu.classList.toggle('active');
  menuToggle.classList.toggle('active');
});

// Pages (Diperbarui)
const pages = { 
  login: document.getElementById('loginPage'), 
  welcome: document.getElementById('welcomePage'),
  home: document.getElementById('homePage'), 
  folder1: document.getElementById('folder1Page'),
  folder2: document.getElementById('folder2Page'),
  about: document.getElementById('aboutPage'), 
  contact: document.getElementById('contactPage'),
  chat: document.getElementById('chatPage') // PENAMBAHAN
};

// Data Album (TIDAK BERUBAH)
const albumData = {
  main: { /* ... */ container: document.getElementById('albumContainer'), indicator: document.getElementById('mainPhotoIndicator'), spinner: document.getElementById('mainSpinner')},
  folder1: { photos: [ /* ... */ ], current: 0, liked: false, container: null, indicator: null, spinner: null },
  folder2: { photos: [ /* ... */ ], current: 0, liked: false, container: null, indicator: null, spinner: null }
};

let autoSwipeInterval;
let loggedInUsername = ''; 

// Login (Diperbarui)
const loginBtn = document.getElementById('loginBtn');
const loginError = document.getElementById('loginError');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const togglePass = document.getElementById('togglePass');
const albumWrapper = document.getElementById('albumWrapper'); 
const folderSelectWrapper = document.getElementById('folderSelectWrapper');
const music = document.getElementById('bgMusic');
const displayUsername = document.getElementById('displayUsername');
const startBrowsingBtn = document.getElementById('startBrowsingBtn');

togglePass.addEventListener('click', ()=>{
  passwordInput.type = (passwordInput.type==='password')?'text':'password'; 
  togglePass.textContent = (passwordInput.type==='password')?'Show Password':'Hide Password'; 
});

loginBtn.addEventListener('click', ()=>{
  const user = usernameInput.value.trim();
  const pass = passwordInput.value.trim();
  
  if(loginCredentials[user] === pass){ // LOGIKA LOGIN BARU
    loginError.style.display='none';
    document.querySelector('.navbar').style.display='flex';
    
    myUserId = user; 
    myUserName = CHAT_USER_PROFILES[user].name;
    
    displayUsername.textContent = myUserName.toUpperCase(); 
    
    // PENTING: HUBUNGKAN SOCKET DENGAN ID PENGGUNA
    socket.emit('user_login', myUserId);
    
    showPage('welcome'); 
    clearInterval(autoSwipeInterval); 
  } else {
    loginError.style.display='block';
  }
});

startBrowsingBtn.addEventListener('click', () => {
  showPage('home'); // Setelah welcome, langsung ke home (pemilihan folder)
});

// FUNGSI UTAMA UNTUK MENAMPILKAN HALAMAN (TIDAK BERUBAH)
function showPage(page){
  // 1. Matikan semua halaman dan hapus kelas aktif
  for(const key in pages){ 
    pages[key].style.display = 'none';
    pages[key].classList.remove('active-page');
  }

  // 2. Tampilkan halaman yang diminta
  if (page === 'home' || page === 'mainAlbum') {
      pages['home'].style.display = 'flex';
      pages['home'].classList.add('active-page');
      
      if (page === 'home') {
           folderSelectWrapper.style.display = 'flex'; 
           albumWrapper.style.display = 'none';
           clearInterval(autoSwipeInterval); 
      } else { 
           folderSelectWrapper.style.display = 'none';
           albumWrapper.style.display = 'block'; 
      }
  } else {
      pages[page].style.display = 'flex'; 
      pages[page].classList.add('active-page'); 
  }
  
  // Nonaktifkan menu toggle saat mengganti halaman
  navMenu.classList.remove('active');
  menuToggle.classList.remove('active');

  // Putar musik jika bukan halaman login/welcome
  if(page !== 'login' && page !== 'welcome' && page !== 'about' && page !== 'contact' && page !== 'chat') playMusicIfAlbum();
}


// FUNGSI ALBUM (TIDAK BERUBAH)
function showPhoto(folder, i){ /* ... */ }
function navPhoto(folder, direction){ /* ... */ }
function initMainAlbum(){ /* ... */ }
function initFolderAlbum(folder){ /* ... */ }
function updatePhotoIndicator(folder){ /* ... */ }
function startAutoSwipe(folder){ /* ... */ }
function resetAutoSwipe(folder){ /* ... */ }
function setupSwipe(element, folder){ /* ... */ }


// Folder Selection Buttons (TIDAK BERUBAH)
document.getElementById('mainAlbumBtn').onclick = ()=>{
    showPage('mainAlbum'); 
    initMainAlbum();
};
document.getElementById('folder1Btn').onclick = ()=>{
    showPage('folder1');
    initFolderAlbum('folder1');
};
document.getElementById('folder2Btn').onclick = ()=>{
    showPage('folder2');
    initFolderAlbum('folder2');
};

// Navbar buttons (Diperbarui)
const chatNavBtn = document.getElementById('chatNavBtn');
chatNavBtn.onclick=()=>showPage('chat'); // PENAMBAHAN
document.getElementById('homeBtn').onclick=()=>showPage('home');
document.getElementById('aboutBtn').onclick=()=>showPage('about');
document.getElementById('contactBtn').onclick=()=>showPage('contact');

// Particle (TIDAK BERUBAH)
const particleContainer = document.getElementById('particleContainer');
function createParticle() { /* ... */ }
for(let i=0;i<50;i++){ createParticle(); }


// Photo menu actions (TIDAK BERUBAH)
function updateLikeButton(button, isLiked){ /* ... */ }
function toggleLike(folder){ /* ... */ }
function sharePhoto(folder){ /* ... */ }
function downloadPhoto(folder){ /* ... */ }

// Musik album (TIDAK BERUBAH)
function playMusicIfAlbum(){
  music.play().catch(()=>{}); 
}
document.body.addEventListener('click', ()=>{ music.play(); }, {once:true});


// --- FUNGSI CHAT (BARU) ---
const chatInput = document.getElementById('chatInput');
const sendChatBtn = document.getElementById('sendChatBtn');
const chatMessages = document.getElementById('chatMessages');
const chatStatus = document.getElementById('chatStatus');
const opponentNameEl = document.getElementById('opponentName');
const opponentAvatarEl = document.getElementById('opponentAvatar');


function updateChatHeader(usersData) {
    const opponentId = myUserId === 'zaza' ? 'khirza' : 'zaza';
    opponentInfo = usersData[opponentId] || CHAT_USER_PROFILES[opponentId];
    
    if (opponentInfo) {
        opponentNameEl.innerHTML = opponentInfo.name + (opponentInfo.isVerified ? ' <span class="material-icons" style="font-size: 1em; color: #7aff7a; vertical-align: middle;">verified</span>' : '');
        opponentAvatarEl.textContent = opponentInfo.avatar;
    }
}

function addMessageToChat(data, isHistory = false) {
    const { message, timestamp, senderId, status } = data;
    const isMe = senderId === myUserId;
    const timeDisplay = timestamp || new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });

    const msgDiv = document.createElement('div');
    msgDiv.classList.add('chat-bubble');
    msgDiv.id = `msg-${data.id || Date.now()}`;

    // Inline CSS untuk gelembung chat
    msgDiv.style.cssText = `
        max-width: 80%;
        padding: 10px 15px;
        border-radius: 15px;
        color: ${isMe ? 'white' : '#333'};
        word-wrap: break-word;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        font-size: 0.95em;
        line-height: 1.4;
        align-self: ${isMe ? 'flex-end' : 'flex-start'};
        background: ${isMe ? '#ff99c7' : 'rgba(255,255,255,0.85)'};
        border-bottom-${isMe ? 'right' : 'left'}-radius: 0;
    `;

    // Konten Pesan + Jam + Status (Centang)
    msgDiv.innerHTML = `
        ${message}
        <span style="display: block; font-size: 0.75em; margin-top: 5px; text-align: right; color: ${isMe ? 'rgba(255,255,255,0.8)' : 'rgba(0,0,0,0.6)'};">
            ${timeDisplay}
            ${isMe ? `<span class="material-icons message-status" data-id="${data.id || Date.now()}" style="font-size: 1em; margin-left: 3px; vertical-align: middle; color: ${status === 'read' ? '#00e676' : 'rgba(255,255,255,0.8)'};">${status === 'read' ? 'done_all' : (status === 'sent' ? 'done_all' : 'schedule')}</span>` : ''}
        </span>
    `;

    chatMessages.appendChild(msgDiv);
    if (!isHistory) chatMessages.scrollTop = chatMessages.scrollHeight;
}

function updateMessageStatus(data) {
    const statusIcon = document.querySelector(`.message-status[data-id="${data.id}"]`);
    if (statusIcon) {
        if (data.status === 'read') {
            statusIcon.textContent = 'done_all';
            statusIcon.style.color = '#00e676';
        } else if (data.status === 'sent') {
            statusIcon.textContent = 'done_all';
            statusIcon.style.color = 'rgba(255,255,255,0.8)';
        }
    }
}

// --- SOCKET LISTENERS ---
socket.on('load_users', (usersData) => { updateChatHeader(usersData); });
socket.on('load_history', (history) => {
    chatMessages.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.6); font-size: 0.8em;">-- Chat hanya berfungsi jika server backend berjalan di localhost:3000 --</div>';
    history.forEach(msg => addMessageToChat(msg, true));
    chatMessages.scrollTop = chatMessages.scrollHeight;
});
socket.on('receive_message', (data) => { addMessageToChat(data); });
socket.on('update_status', (data) => { updateMessageStatus(data); });
socket.on('user_status_update', (onlineIds) => {
    const opponentId = myUserId === 'zaza' ? 'khirza' : 'zaza';
    
    if (onlineIds.includes(opponentId)) {
        chatStatus.textContent = 'Online âœ¨';
        chatStatus.style.color = '#7aff7a';
    } else {
        chatStatus.textContent = 'Offline ğŸ˜´';
        chatStatus.style.color = '#ffc0de';
    }
});

// --- EVENT HANDLER CHAT INPUT ---
sendChatBtn.addEventListener('click', () => {
    const message = chatInput.value.trim();
    if (message !== '' && myUserId) {
        socket.emit('send_message', {
            senderId: myUserId,
            message: message,
        });
        chatInput.value = '';
    }
});
chatInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendChatBtn.click();
});
</script>
</body>
</html>
